<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/rui-wiki/app.svg" />
    <link rel="manifest" href="/rui-wiki/manifest.json" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>RuiWiki</title>
    <script type="module" crossorigin>
(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const c of i.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&o(c)}).observe(document,{childList:!0,subtree:!0});function e(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(n){if(n.ep)return;n.ep=!0;const i=e(n);fetch(n.href,i)}})();function w(t){return new Promise((r,e)=>{t.oncomplete=t.onsuccess=()=>r(t.result),t.onabort=t.onerror=()=>e(t.error)})}function S(t,r){const e=indexedDB.open(t);e.onupgradeneeded=()=>e.result.createObjectStore(r);const o=w(e);return(n,i)=>o.then(c=>i(c.transaction(r,n).objectStore(r)))}let y;function v(){return y||(y=S("keyval-store","keyval")),y}function E(t,r=v()){return r("readonly",e=>w(e.get(t)))}function M(t,r,e=v()){return e("readwrite",o=>(o.put(r,t),w(o.transaction)))}const P=(t,r)=>{const e=r.document.createElement("script");return e.src=t,r.document.querySelector("head").appendChild(e),new Promise((o,n)=>{e.addEventListener("load",()=>{o(e)}),e.addEventListener("error",()=>{n(new Error(`Can not load: ${t}`))})})};function k(t){const r=new Map;return(e,o)=>{const n=r.get(e);return n?Promise.resolve(n):t(e,o).then(i=>(r.set(e,i),i))}}const O=k(P),q={init:async function(t){return await O("https://cdn.jsdelivr.net/npm/ace-builds@1.32.2/src-min-noconflict/ace.min.js",t),{create:(r,e)=>{const o=t.document.createElement("div"),n=t.ace.edit(o);return n.setOptions({maxLines:1/0,copyWithEmptySelection:!0}),n.setValue(r),{dom:o,get value(){return n.getValue()}}}}}},H=t=>t.ctrlKey&&!t.metaKey||!t.ctrlKey&&t.metaKey;let p=new Map;window.ruiwiki={};async function j(){document.body.classList.add("dark");const t='<nav class="open"></nav><main></main>',r=document.getElementById("app");r.innerHTML=t;const e=document.querySelector("nav"),o=document.querySelector("main");e.innerHTML='<div class="menuButton"><span class="bar"></span></div><button class="directory">directory</button><ul></ul>';const n=e.querySelector(".menuButton");n.onclick=()=>{e.classList.toggle("open")};const i=e.querySelector("button");i.onclick=async()=>{const l=await window.showDirectoryPicker();await M("directory",l),await h(l,e)},e.onclick=async l=>{const f=l.target;if(f.tagName!=="LI")return;e.querySelectorAll(".selected").forEach(a=>a.classList.remove("selected")),f.classList.add("selected");const L=f.textContent,m=p.get(L),b=await m.getFile(),u=document.createElement("iframe");u.src=URL.createObjectURL(b),window.ruiwiki.getSettings=()=>({overwrite:async d=>{if(!m)return!1;try{const s=await m.createWritable();return s.write(d),await s.close(),!0}catch(s){return console.log(s),!1}},plugins:{editor:q}}),u.onload=()=>{var d;const a=(d=u.contentWindow)==null?void 0:d.document.body;a==null||a.addEventListener("keydown",s=>{var g;H(s)&&s.key==="s"&&(s.preventDefault(),(g=a==null?void 0:a.querySelector(".sideMenu .iconButton.overwrite"))==null||g.click())})},o.innerHTML="",o.appendChild(u)};const c=await E("directory");c&&await B(c)&&await h(c,e)}async function h(t,r){p.clear();const e=r.querySelector("ul");e.innerHTML="";for await(let[o,n]of t)n.kind==="file"&&(!n.name.endsWith(".html")||n.name.endsWith(".rwk")||(p.set(o,n),e.insertAdjacentHTML("beforeend",`<li>${o}</li>`)))}async function B(t,r="readwrite"){const e={mode:r};return await t.queryPermission(e)==="granted"||await t.requestPermission(e)==="granted"}j();

</script>
    <style>
*:where(:not(html,iframe,canvas,img,svg,video,audio):not(svg *,symbol *)){all:unset;display:revert}*,*:before,*:after{box-sizing:border-box}html{-moz-text-size-adjust:none;-webkit-text-size-adjust:none;text-size-adjust:none}a,button{cursor:revert}ol,ul,menu,summary{list-style:none}img{max-inline-size:100%;max-block-size:100%}table{border-collapse:collapse}input,textarea{-webkit-user-select:auto}textarea{white-space:revert}meter{-webkit-appearance:revert;-moz-appearance:revert;appearance:revert}:where(pre){all:revert;box-sizing:border-box}::placeholder{color:unset}:where([hidden]){display:none}:where([contenteditable]:not([contenteditable=false])){-moz-user-modify:read-write;-webkit-user-modify:read-write;overflow-wrap:break-word;-webkit-line-break:after-white-space;-webkit-user-select:auto}:where([draggable=true]){-webkit-user-drag:element}:where(dialog:modal){all:revert;box-sizing:border-box}html{font-size:16px}body{color:var(--gray-800);background-color:var(--gray-300);width:100vw;height:100vh;overflow:hidden;--gray-50: #f7f7f7;--gray-100: #ebedee;--gray-200: #e7e7e7;--gray-300: #d5d5d5;--gray-400: #9696a2;--gray-500: #81808d;--gray-600: #4d4c54;--gray-700: #313135;--gray-800: #1b1a1f;--gray-900: #131215}body.dark{--gray-50: #131215;--gray-100: #1b1a1f;--gray-200: #313135;--gray-300: #4d4c54;--gray-400: #81808d;--gray-500: #9696a2;--gray-600: #d5d5d5;--gray-700: #e7e7e7;--gray-800: #ebedee;--gray-900: #f7f7f7}#app{display:flex;flex-direction:row;width:100vw;height:100vh;overflow:auto}nav{position:fixed;display:block;left:-17rem;top:0;width:17rem;height:100vh;background-color:var(--gray-200);color:var(--gray-800);flex-shrink:0;padding:1rem;transition:.3s;opacity:.5}nav.open{left:0;top:0;opacity:1}main{flex-grow:1;width:100%}iframe{width:100%;height:100%;border:none;display:block}.menuButton{position:fixed;top:1rem;left:1rem;display:flex;height:3rem;width:3rem;justify-content:center;align-items:center;z-index:1;background-color:var(--gray-400);border-radius:50%}.menuButton span,.menuButton span:before,.menuButton span:after{content:"";display:block;height:3px;width:25px;border-radius:3px;background-color:var(--gray-600);position:absolute;transition:.3s}.menuButton span:before{bottom:8px}.menuButton span:after{top:8px}.open .menuButton span{background-color:#fff0}.open .menuButton span:before{bottom:0;transform:rotate(45deg)}.open .menuButton span:after{top:0;transform:rotate(-45deg)}.directory{margin-left:4rem}button{display:inline-block;outline:0;border:0;cursor:pointer;will-change:box-shadow,transform;background:var(--gray-100);box-shadow:0 2px 4px #2d234266,0 7px 13px -3px #2d23424d,inset 0 -3px 0 var(--gray-300);height:48px;padding:0 32px;font-size:18px;border-radius:6px;color:var(--gray-700);transition:box-shadow .15s ease,transform .15s ease}button:hover{box-shadow:0 4px 8px #2d234266,0 7px 13px -3px #2d23424d,inset 0 -3px 0 var(--gray-300);transform:translateY(-2px)}button:active{box-shadow:inset 0 3px 7px var(--gray-300);transform:translateY(2px)}ul{padding:1rem 0}li{display:block;color:var(--gray-500);padding-left:1rem;line-height:2rem;cursor:pointer}li:hover{color:var(--gray-800);text-decoration:underline}li.selected{color:var(--gray-700)}

</style>
  </head>
  <body>
    <div id="app"></div>
    <script type="text/typescript">
      if (navigator.serviceWorker) {
        navigator.serviceWorker
          .register('/rui-wiki/sw.js')
          .then((registration) => {
            console.log('scope:', registration.scope);
          })
          .catch((error) => {
            console.log('failed: ', error);
          });
      }
    </script>
  </body>
</html>
